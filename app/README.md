# 开发记录

5月4日：

- 登录界面开发
  - 使用shared_preferences 插件存储token，实现持久化。
  - 使用http package完成网络请求。url使用统一的类进行管理。
  - 实现输入用户名和密码，点击用户登录按钮的登录功能。用户名和密码有空值校验，存在空值有弹窗提示。登录成功保存userdata实现持久化，登录失败有弹窗提示。
  - 实现登录成功自动跳转主页。
- 实现主页中的个人中心界面开发
  - 展示基础用户头像和个人信息。
  - 设计了退出登录功能，本质上是清空本地用户信息并跳转到登录界面。
- 实现主页中根据用户权限不同显示不同的菜单项

5月6日：

- 保持登录状态
  - 创建initpage校验本地登录信息，如果保存的登录信息有效，打开软件直接进入主页，否则显示登录界面。
- 应用状态管理
  - 在根部创建一个userTokenProvider用来管理用户的token，在每一个子widget中都能访问到。
  - 这个provider应用加载的时候调用shared_prefefences完成数据加载并向服务器发起验证。应用等待加载并验证完成之后才渲染对应页面。
- 申请界面开发
  - 右下角放置一个加号按钮，点击进去显示弹窗，弹窗中显示出可以提出的申请类型。该弹窗从provider中获取token，并利用token向服务器请求数据并展示出来。

5月8日：

- 解决无网络报错（try catch）
  - initpage的token校验没有网络直接跳转到登录界面。
  - 登录界面登录没有网络显示弹窗。请求模版列表没有网络显示弹窗。
- 使用snackbar替代报错弹窗
- 实现模版选择弹窗大小的自适应。弹窗内的项目用色块展示，而且设置了监听，可以点击对应的项目。显示模版请求有错误均显示弹窗。
- 实现点击模版项可以跳转到填写申请表单的界面，点击右上角可以返回到之前的页面。
- 在申请界面添加appbar，appbar中设置菜单选项，点击可以选择显示当前申请或者历史申请。对应appbar名字会改变，widget中也会显示对应不同的listwidget。
- 参照申请页面的格式完成审批页面和运维页面的基本布局（appbar菜单选项）

后端接口需求：

- 根据processDefinitionKey获取表单内容的接口
- listProcessInstances返回的信息中增加每一个流程实例的名称，开始时间，最好还有当前执行到的流程步骤，比如说当前状态：部长审批。用来展示列表的时候展示基本信息。
- 提供表单选项的接口，比如部门项有哪些，作为填写表单的时候作选项。
- 在表单中增加两个字段，分别为：是否提供可选项，可选项获取的API接口

5月9日：

- 完善当前申请界面，可向后端请求当前正在执行的流程，并可以点击跳转到流程实例详情页面，显示对应实例的详情。所有申请项以card的形式展示在listview中，然后一个card中展示流程名称、流程开始时间和流程实例的id信息。
- 利用intl包实现日期转换，将后端数据转换为年月日的形式进行渲染。
- 在当前申请widget中利用RefreshIndicator实现了下拉刷新。
- 点击流程模版之后可以显示申请的表单
- 表单增加了非空的校验，点击提交表单之后可以完成创建流程和提交表单的操作，针对步骤中的错误会抛出警告。

5月10日：

- 完成表单填写的全流程，针对部门设置了下拉选择框，针对日期设置了日期选择器，针对数字类型设置了整数校验，针对所有输入设置了非空校验。提交表单之后直接跳转到主页，并且提示提交成功。表单界面appbar的标题为对应表单的名字。
- 在表单申请界面加载原始流程图并展示在表单上方。
- 完善了填写申请表单界面，稍微美观了一点
- 编写基本的流程实例详情界面，显示了基本的流程名称、id、开始结束时间、是否完成等信息。后续加时间轴和流程图。

5月11日：

- 完善了当前流程界面，添加了图片的显示，增加了时间线，时间线中每一项可以点击右侧的菜单项，再点进去可以查看具体的表单，增加了一个撤销流程的按钮，点击有弹窗，弹窗流程已经搭建好了，就差接口。

后端接口需求：

- 获取本人流程列表的接口拆分，拆成两个接口，一个是获取当前流程实例列表，另一个是获取历史流程实例列表
- 在流程实例信息中添加截止时间字段
- 审批人获取审批列表的字段增加task对应的流程的名字，流程发起人和流程截止时间
- 增加根据taskid查询对应流程之前的流程记录信息的接口
